# 05 アクセス制御（FW/ACL）

## 1. 方針

* 最小許可で通信を通す。
* LAN内前提だが、VM間は必要な通信のみ許可する。
* 実装はUFW/iptables/nftables/ルータACLのいずれかで実施する。

---

## 2. 許可ルール一覧（最小）

| From | To | Port/Proto | 目的 |
| --- | --- | --- | --- |
| LAN client | lb-proxy | 80/tcp | Webアクセス |
| LAN client | lb-proxy | 22/tcp | Git SSH |
| lb-proxy | gitlab-app | 80/tcp | HTTP reverse proxy |
| lb-proxy | gitlab-app | 22/tcp | SSH L4 proxy |
| gitlab-app | gitlab-db | 5432/tcp | PostgreSQL |
| gitlab-app | gitlab-redis | 6379/tcp | Redis |
| gitlab-app | gitlab-gitaly | 8075/tcp | Gitaly |
| gha-runner | lb-proxy | 22/tcp | mirror push |
| gha-runner | GitHub | 443/tcp outbound | Actions API |

---

## 3. 既定ポリシー

* inbound: deny
* outbound: allow（必要に応じて制限）

---

## 4. 例外

* OS更新のための外向き通信を許可（TBD）
