# 01 全体パラメータシート（共通）

## 1. 構成概要

* 構成: 6VM
* 目的: LAN内Git/Wiki + GitHub->GitLab mirror push
* OS: Debian 12
* GitLab: GitLab EE（Omnibus）
* HTTPS: 使用しない（HTTP運用）

---

## 2. ホスト名 / 役割 / IP

| ホスト名 | 役割 | IP | 備考 |
| --- | --- | --- | --- |
| lb-proxy | HTTP/SSH入口（Nginx） | TBD | external_urlの入口 | 
| gitlab-app | GitLabアプリ | TBD | Omnibus本体 | 
| gitlab-db | PostgreSQL | TBD | 外部DB | 
| gitlab-redis | Redis | TBD | 外部Redis | 
| gitlab-gitaly | Gitaly | TBD | リポジトリ実体 | 
| gha-runner | GitHub Actions self-hosted runner | TBD | GitHub->GitLab mirror push | 

---

## 3. URL / アクセス

* external_url: `http://<lb-proxy-ip>`
* SSH入口: `<lb-proxy-ip>:22`

---

## 4. ポート一覧（要約）

| From | To | Port/Proto | 用途 |
| --- | --- | --- | --- |
| LAN client | lb-proxy | 80/tcp | GitLab Web | 
| LAN client | lb-proxy | 22/tcp | Git SSH | 
| lb-proxy | gitlab-app | 80/tcp | HTTP reverse proxy | 
| lb-proxy | gitlab-app | 22/tcp | SSH L4 proxy | 
| gitlab-app | gitlab-db | 5432/tcp | PostgreSQL | 
| gitlab-app | gitlab-redis | 6379/tcp | Redis | 
| gitlab-app | gitlab-gitaly | 8075/tcp | Gitaly | 
| gha-runner | GitHub | 443/tcp outbound | GitHub Actions | 
| gha-runner | lb-proxy | 22/tcp | mirror push | 

---

## 5. アカウント / 認証情報

* GitLab管理者アカウント: TBD
* GitHub機械ユーザー: TBD
* GitLab機械ユーザー: TBD
* DBユーザー: `gitlab`（パスワード: TBD）
* Gitaly token: TBD（長い文字列）
* `/etc/gitlab/gitlab-secrets.json`: gitlab-appとgitlab-gitalyで一致

---

## 6. ストレージ / パス

* Gitalyリポジトリパス: `/var/opt/gitlab/git-data/repositories`
* GitLab設定: `/etc/gitlab/gitlab.rb`
* GitLab secrets: `/etc/gitlab/gitlab-secrets.json`

---

## 7. 監視 / ログ（代表）

* Nginx: `/var/log/nginx/access.log`, `/var/log/nginx/error.log`
* GitLab: `/var/log/gitlab/`

---

## 8. バックアップ

* 方式: GitLab公式バックアップ
* スケジュール: 毎日1回
* 世代: 2世代
* 保管先: Proxmoxホスト側（VM外）

---

## 9. タイムゾーン / 時刻同期

* タイムゾーン: TBD
* NTP: systemd-timesyncd or chrony

---

## 10. バージョン方針

* Debian: 12（固定）
* GitLab EE: 安定版最新（具体版はTBD）
* Nginx: Debianパッケージ（`nginx` + `libnginx-mod-stream`）
